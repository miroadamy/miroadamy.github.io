<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Tutorial on Elastic - Miro&#39;s World</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Miro Adamy" /><meta name="description" content="Running elastic (see Elastic search and Kibana - getting started)
 Use case: building a employee directory for Megacorp
  each document - type of &amp;lsquo;employee&amp;rsquo; everything in megacorp index  Populating # Delete the `megacorp` index in case it already exists DELETE /megacorp # Index document 1, type &amp;#34;employee&amp;#34;, in the # &amp;#34;megacorp&amp;#34; index PUT /megacorp/employee/1 { &amp;#34;first_name&amp;#34; : &amp;#34;John&amp;#34;, &amp;#34;last_name&amp;#34; : &amp;#34;Smith&amp;#34;, &amp;#34;age&amp;#34; : 25, &amp;#34;about&amp;#34; : &amp;#34;I love to go rock climbing&amp;#34;, &amp;#34;interests&amp;#34;: [ &amp;#34;sports&amp;#34;, &amp;#34;music&amp;#34; ] } # Index two more documents PUT /megacorp/employee/2 { &amp;#34;first_name&amp;#34; : &amp;#34;Jane&amp;#34;, &amp;#34;last_name&amp;#34; : &amp;#34;Smith&amp;#34;, &amp;#34;age&amp;#34; : 32, &amp;#34;about&amp;#34; : &amp;#34;I like to collect rock albums&amp;#34;, &amp;#34;interests&amp;#34;: [ &amp;#34;music&amp;#34; ] } PUT /megacorp/employee/3 { &amp;#34;first_name&amp;#34; : &amp;#34;Douglas&amp;#34;, &amp;#34;last_name&amp;#34; : &amp;#34;Fir&amp;#34;, &amp;#34;age&amp;#34; : 35, &amp;#34;about&amp;#34;: &amp;#34;I like to build cabinets&amp;#34;, &amp;#34;interests&amp;#34;: [ &amp;#34;forestry&amp;#34; ] } In server" /><meta name="keywords" content="blog, Miro" />






<meta name="generator" content="Hugo 0.79.0 with theme even" />


<link rel="canonical" href="https://miroadamy.com/posts/2014-08-28-elastic-tutorial/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">


<link href="/dist/even.c2a46f00.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Tutorial on Elastic" />
<meta property="og:description" content="Running elastic (see Elastic search and Kibana - getting started)
 Use case: building a employee directory for Megacorp
  each document - type of &lsquo;employee&rsquo; everything in megacorp index  Populating # Delete the `megacorp` index in case it already exists DELETE /megacorp # Index document 1, type &#34;employee&#34;, in the # &#34;megacorp&#34; index PUT /megacorp/employee/1 { &#34;first_name&#34; : &#34;John&#34;, &#34;last_name&#34; : &#34;Smith&#34;, &#34;age&#34; : 25, &#34;about&#34; : &#34;I love to go rock climbing&#34;, &#34;interests&#34;: [ &#34;sports&#34;, &#34;music&#34; ] } # Index two more documents PUT /megacorp/employee/2 { &#34;first_name&#34; : &#34;Jane&#34;, &#34;last_name&#34; : &#34;Smith&#34;, &#34;age&#34; : 32, &#34;about&#34; : &#34;I like to collect rock albums&#34;, &#34;interests&#34;: [ &#34;music&#34; ] } PUT /megacorp/employee/3 { &#34;first_name&#34; : &#34;Douglas&#34;, &#34;last_name&#34; : &#34;Fir&#34;, &#34;age&#34; : 35, &#34;about&#34;: &#34;I like to build cabinets&#34;, &#34;interests&#34;: [ &#34;forestry&#34; ] } In server" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://miroadamy.com/posts/2014-08-28-elastic-tutorial/" />
<meta property="article:published_time" content="2014-08-28T11:22:48+08:00" />
<meta property="article:modified_time" content="2014-08-28T11:22:48+08:00" />
<meta itemprop="name" content="Tutorial on Elastic">
<meta itemprop="description" content="Running elastic (see Elastic search and Kibana - getting started)
 Use case: building a employee directory for Megacorp
  each document - type of &lsquo;employee&rsquo; everything in megacorp index  Populating # Delete the `megacorp` index in case it already exists DELETE /megacorp # Index document 1, type &#34;employee&#34;, in the # &#34;megacorp&#34; index PUT /megacorp/employee/1 { &#34;first_name&#34; : &#34;John&#34;, &#34;last_name&#34; : &#34;Smith&#34;, &#34;age&#34; : 25, &#34;about&#34; : &#34;I love to go rock climbing&#34;, &#34;interests&#34;: [ &#34;sports&#34;, &#34;music&#34; ] } # Index two more documents PUT /megacorp/employee/2 { &#34;first_name&#34; : &#34;Jane&#34;, &#34;last_name&#34; : &#34;Smith&#34;, &#34;age&#34; : 32, &#34;about&#34; : &#34;I like to collect rock albums&#34;, &#34;interests&#34;: [ &#34;music&#34; ] } PUT /megacorp/employee/3 { &#34;first_name&#34; : &#34;Douglas&#34;, &#34;last_name&#34; : &#34;Fir&#34;, &#34;age&#34; : 35, &#34;about&#34;: &#34;I like to build cabinets&#34;, &#34;interests&#34;: [ &#34;forestry&#34; ] } In server">
<meta itemprop="datePublished" content="2014-08-28T11:22:48+08:00" />
<meta itemprop="dateModified" content="2014-08-28T11:22:48+08:00" />
<meta itemprop="wordCount" content="1658">



<meta itemprop="keywords" content="search,elastic,tutorial," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Tutorial on Elastic"/>
<meta name="twitter:description" content="Running elastic (see Elastic search and Kibana - getting started)
 Use case: building a employee directory for Megacorp
  each document - type of &lsquo;employee&rsquo; everything in megacorp index  Populating # Delete the `megacorp` index in case it already exists DELETE /megacorp # Index document 1, type &#34;employee&#34;, in the # &#34;megacorp&#34; index PUT /megacorp/employee/1 { &#34;first_name&#34; : &#34;John&#34;, &#34;last_name&#34; : &#34;Smith&#34;, &#34;age&#34; : 25, &#34;about&#34; : &#34;I love to go rock climbing&#34;, &#34;interests&#34;: [ &#34;sports&#34;, &#34;music&#34; ] } # Index two more documents PUT /megacorp/employee/2 { &#34;first_name&#34; : &#34;Jane&#34;, &#34;last_name&#34; : &#34;Smith&#34;, &#34;age&#34; : 32, &#34;about&#34; : &#34;I like to collect rock albums&#34;, &#34;interests&#34;: [ &#34;music&#34; ] } PUT /megacorp/employee/3 { &#34;first_name&#34; : &#34;Douglas&#34;, &#34;last_name&#34; : &#34;Fir&#34;, &#34;age&#34; : 35, &#34;about&#34;: &#34;I like to build cabinets&#34;, &#34;interests&#34;: [ &#34;forestry&#34; ] } In server"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Miro&#39;s World</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/posts/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Miro&#39;s World</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/posts/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Tutorial on Elastic</h1>

      <div class="post-meta">
        <span class="post-time"> 2014-08-28 </span>
        <div class="post-category">
            <a href="/categories/devops/"> devops </a>
            </div>
          <span class="more-meta"> 1658 words </span>
          <span class="more-meta"> 8 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#running-elastic">Running elastic</a></li>
    <li><a href="#populating">Populating</a></li>
    <li><a href="#retrieve">Retrieve</a></li>
    <li><a href="#get-all">Get all</a></li>
    <li><a href="#url-based-search">URL based search</a></li>
    <li><a href="#query-dsl">Query DSL</a></li>
    <li><a href="#filtering">Filtering</a></li>
    <li><a href="#text-queries-with-or">Text queries with OR</a></li>
    <li><a href="#exact-phrase">Exact phrase</a></li>
    <li><a href="#highlight">Highlight</a></li>
    <li><a href="#see-the-html-highlight">See the HTML highlight</a></li>
    <li><a href="#analytics">Analytics</a></li>
    <li><a href="#hierarchical-roll-ups">Hierarchical roll-ups</a></li>
  </ul>

  <ul>
    <li><a href="#retrieve-document">Retrieve document:</a></li>
    <li><a href="#existence-check">Existence check</a></li>
    <li><a href="#update">Update</a></li>
    <li><a href="#create">Create</a></li>
    <li><a href="#delete">Delete</a></li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <h2 id="running-elastic">Running elastic</h2>
<p>(see Elastic search and Kibana - getting started)</p>
<blockquote>
<p>Use case: building a employee directory for Megacorp</p>
</blockquote>
<ul>
<li>each document - type of &lsquo;employee&rsquo;</li>
<li>everything in megacorp index</li>
</ul>
<h2 id="populating">Populating</h2>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback"># Delete the `megacorp` index in case it already exists
DELETE /megacorp
# Index document 1, type &#34;employee&#34;, in the
# &#34;megacorp&#34; index
PUT /megacorp/employee/1
{
    &#34;first_name&#34; : &#34;John&#34;,
    &#34;last_name&#34; :  &#34;Smith&#34;,
    &#34;age&#34; :        25,
    &#34;about&#34; :      &#34;I love to go rock climbing&#34;,
    &#34;interests&#34;: [ &#34;sports&#34;, &#34;music&#34; ]
}
# Index two more documents
PUT /megacorp/employee/2
{
    &#34;first_name&#34; :  &#34;Jane&#34;,
    &#34;last_name&#34; :   &#34;Smith&#34;,
    &#34;age&#34; :         32,
    &#34;about&#34; :       &#34;I like to collect rock albums&#34;,
    &#34;interests&#34;:  [ &#34;music&#34; ]
}
PUT /megacorp/employee/3
{
    &#34;first_name&#34; :  &#34;Douglas&#34;,
    &#34;last_name&#34; :   &#34;Fir&#34;,
    &#34;age&#34; :         35,
    &#34;about&#34;:        &#34;I like to build cabinets&#34;,
    &#34;interests&#34;:  [ &#34;forestry&#34; ]
}
</code></pre></div><p>In server</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">2014-08-28 13:58:02,769][INFO ][cluster.metadata         ] [Sea Urchin] [megacorp] creating index, cause [auto(index api)], shards [5]/[1], mappings []
[2014-08-28 13:58:02,858][INFO ][cluster.metadata         ] [Sea Urchin] [megacorp] update_mapping [employee] (dynamic)
[2014-08-28 13:58:16,319][INFO ][cluster.metadata         ] [Sea Urchin] [megacorp] deleting index
[2014-08-28 13:58:18,891][INFO ][cluster.metadata         ] [Sea Urchin] [megacorp] creating index, cause [auto(index api)], shards [5]/[1], mappings []
[2014-08-28 13:58:18,964][INFO ][cluster.metadata         ] [Sea Urchin] [megacorp] update_mapping [employee] (dynamic)
</code></pre></div><h2 id="retrieve">Retrieve</h2>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback"># Retrieve the updated document
GET /megacorp/employee/1
  
{
   &#34;_index&#34;: &#34;megacorp&#34;,
   &#34;_type&#34;: &#34;employee&#34;,
   &#34;_id&#34;: &#34;1&#34;,
   &#34;_version&#34;: 1,
   &#34;found&#34;: true,
   &#34;_source&#34;: {
      &#34;first_name&#34;: &#34;John&#34;,
      &#34;last_name&#34;: &#34;Smith&#34;,
      &#34;age&#34;: 25,
      &#34;about&#34;: &#34;I love to go rock climbing&#34;,
      &#34;interests&#34;: [
         &#34;sports&#34;,
         &#34;music&#34;
      ]
   }
}
</code></pre></div><h2 id="get-all">Get all</h2>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback"># Search for all employees in the megacorp index:
# By default, returns to 10 results
GET /megacorp/employee/_search
</code></pre></div><h2 id="url-based-search">URL based search</h2>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback"># Search for all employees in the megacorp index
# who have &#34;Smith&#34; in the last_name field
GET /megacorp/employee/_search?q=last_name:Smith
</code></pre></div><h2 id="query-dsl">Query DSL</h2>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback"># Same query as above, but using the Query DSL
GET /megacorp/employee/_search
{
  &#34;query&#34;: {
    &#34;match&#34;: {
      &#34;last_name&#34;: &#34;smith&#34;
    }
  }
}
</code></pre></div><h2 id="filtering">Filtering</h2>
<p>Combines filter (age &gt; 30) and query within filter (last name = Smith)</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback"># Find all employees whose `last_name` is Smith
# and who are older than 30
GET /megacorp/employee/_search
{
    &#34;query&#34; : {
        &#34;filtered&#34; : {
            &#34;filter&#34; : {
                &#34;range&#34; : {
                    &#34;age&#34; : { &#34;gt&#34; : 30 }
                }
            },
            &#34;query&#34; : {
                &#34;match&#34; : {
                    &#34;last_name&#34; : &#34;smith&#34;
                }
            }
        }
    }
}
  
{
   &#34;took&#34;: 5,
   &#34;timed_out&#34;: false,
   &#34;_shards&#34;: {
      &#34;total&#34;: 5,
      &#34;successful&#34;: 5,
      &#34;failed&#34;: 0
   },
   &#34;hits&#34;: {
      &#34;total&#34;: 1,
      &#34;max_score&#34;: 0.30685282,
      &#34;hits&#34;: [
         {
            &#34;_index&#34;: &#34;megacorp&#34;,
            &#34;_type&#34;: &#34;employee&#34;,
            &#34;_id&#34;: &#34;2&#34;,
            &#34;_score&#34;: 0.30685282,
            &#34;_source&#34;: {
               &#34;first_name&#34;: &#34;Jane&#34;,
               &#34;last_name&#34;: &#34;Smith&#34;,
               &#34;age&#34;: 32,
               &#34;about&#34;: &#34;I like to collect rock albums&#34;,
               &#34;interests&#34;: [
                  &#34;music&#34;
               ]
            }
         }
      ]
   }
}
</code></pre></div><h2 id="text-queries-with-or">Text queries with OR</h2>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback"># Find all employees who enjoy &#34;rock&#34; or &#34;climbing&#34;
GET /megacorp/employee/_search
{
    &#34;query&#34; : {
        &#34;match&#34; : {
            &#34;about&#34; : &#34;rock climbing&#34;
        }
    }
}
</code></pre></div><p>Note the OR and how relevance is different</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">{
   &#34;took&#34;: 5,
   &#34;timed_out&#34;: false,
   &#34;_shards&#34;: {
      &#34;total&#34;: 5,
      &#34;successful&#34;: 5,
      &#34;failed&#34;: 0
   },
   &#34;hits&#34;: {
      &#34;total&#34;: 2,
      &#34;max_score&#34;: 0.16273327,
      &#34;hits&#34;: [
         {
            &#34;_index&#34;: &#34;megacorp&#34;,
            &#34;_type&#34;: &#34;employee&#34;,
            &#34;_id&#34;: &#34;1&#34;,
            &#34;_score&#34;: 0.16273327,
            &#34;_source&#34;: {
               &#34;first_name&#34;: &#34;John&#34;,
               &#34;last_name&#34;: &#34;Smith&#34;,
               &#34;age&#34;: 25,
               &#34;about&#34;: &#34;I love to go rock climbing&#34;,
               &#34;interests&#34;: [
                  &#34;sports&#34;,
                  &#34;music&#34;
               ]
            }
         },
         {
            &#34;_index&#34;: &#34;megacorp&#34;,
            &#34;_type&#34;: &#34;employee&#34;,
            &#34;_id&#34;: &#34;2&#34;,
            &#34;_score&#34;: 0.016878016,
            &#34;_source&#34;: {
               &#34;first_name&#34;: &#34;Jane&#34;,
               &#34;last_name&#34;: &#34;Smith&#34;,
               &#34;age&#34;: 32,
               &#34;about&#34;: &#34;I like to collect rock albums&#34;,
               &#34;interests&#34;: [
                  &#34;music&#34;
               ]
            }
         }
      ]
   }
}
</code></pre></div><p>Elasticsearch can search within full text fields and return the most relevant results first.</p>
<h2 id="exact-phrase">Exact phrase</h2>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback"># Find all employees who enjoy &#34;rock climbing&#34;
GET /megacorp/employee/_search
{
    &#34;query&#34; : {
        &#34;match_phrase&#34; : {
            &#34;about&#34; : &#34;rock climbing&#34;
        }
    }
}
</code></pre></div><p>Gives back higher score</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">{
   &#34;took&#34;: 4,
   &#34;timed_out&#34;: false,
   &#34;_shards&#34;: {
      &#34;total&#34;: 5,
      &#34;successful&#34;: 5,
      &#34;failed&#34;: 0
   },
   &#34;hits&#34;: {
      &#34;total&#34;: 1,
      &#34;max_score&#34;: 0.23013961,
      &#34;hits&#34;: [
         {
            &#34;_index&#34;: &#34;megacorp&#34;,
            &#34;_type&#34;: &#34;employee&#34;,
            &#34;_id&#34;: &#34;1&#34;,
            &#34;_score&#34;: 0.23013961,
            &#34;_source&#34;: {
               &#34;first_name&#34;: &#34;John&#34;,
               &#34;last_name&#34;: &#34;Smith&#34;,
               &#34;age&#34;: 25,
               &#34;about&#34;: &#34;I love to go rock climbing&#34;,
               &#34;interests&#34;: [
                  &#34;sports&#34;,
                  &#34;music&#34;
               ]
            }
         }
      ]
   }
}
</code></pre></div><h2 id="highlight">Highlight</h2>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">GET /megacorp/employee/_search
{
    &#34;query&#34; : {
        &#34;match_phrase&#34; : {
            &#34;about&#34; : &#34;rock climbing&#34;
        }
    },
    &#34;highlight&#34;: {
        &#34;fields&#34; : {
            &#34;about&#34; : {}
        }
    }
}
</code></pre></div><h2 id="see-the-html-highlight">See the HTML highlight</h2>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">{
   &#34;took&#34;: 18,
   &#34;timed_out&#34;: false,
   &#34;_shards&#34;: {
      &#34;total&#34;: 5,
      &#34;successful&#34;: 5,
      &#34;failed&#34;: 0
   },
   &#34;hits&#34;: {
      &#34;total&#34;: 1,
      &#34;max_score&#34;: 0.23013961,
      &#34;hits&#34;: [
         {
            &#34;_index&#34;: &#34;megacorp&#34;,
            &#34;_type&#34;: &#34;employee&#34;,
            &#34;_id&#34;: &#34;1&#34;,
            &#34;_score&#34;: 0.23013961,
            &#34;_source&#34;: {
               &#34;first_name&#34;: &#34;John&#34;,
               &#34;last_name&#34;: &#34;Smith&#34;,
               &#34;age&#34;: 25,
               &#34;about&#34;: &#34;I love to go rock climbing&#34;,
               &#34;interests&#34;: [
                  &#34;sports&#34;,
                  &#34;music&#34;
               ]
            },
            &#34;highlight&#34;: {
               &#34;about&#34;: [
                  &#34;I love to go &lt;em&gt;rock&lt;/em&gt; &lt;em&gt;climbing&lt;/em&gt;&#34;
               ]
            }
         }
      ]
   }
}
</code></pre></div><h2 id="analytics">Analytics</h2>
<ul>
<li>not recalculated</li>
<li>on the fly</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback"># Calculate the most popular interests for all employees
GET /megacorp/employee/_search
{
  &#34;aggs&#34;: {
    &#34;all_interests&#34;: {
      &#34;terms&#34;: {
        &#34;field&#34;: &#34;interests&#34;
      }
    }
  }
}
  
  
{
   &#34;took&#34;: 1,
   &#34;timed_out&#34;: false,
   &#34;_shards&#34;: {
      &#34;total&#34;: 5,
      &#34;successful&#34;: 5,
      &#34;failed&#34;: 0
   },
   &#34;hits&#34;: {
      &#34;total&#34;: 3,
      &#34;max_score&#34;: 1,
      &#34;hits&#34;: [
         {
            &#34;_index&#34;: &#34;megacorp&#34;,
            &#34;_type&#34;: &#34;employee&#34;,
            &#34;_id&#34;: &#34;3&#34;,
            &#34;_score&#34;: 1,
            &#34;_source&#34;: {
               &#34;first_name&#34;: &#34;Douglas&#34;,
               &#34;last_name&#34;: &#34;Fir&#34;,
               &#34;age&#34;: 35,
               &#34;about&#34;: &#34;I like to build cabinets&#34;,
               &#34;interests&#34;: [
                  &#34;forestry&#34;
               ]
            }
         },
         {
            &#34;_index&#34;: &#34;megacorp&#34;,
            &#34;_type&#34;: &#34;employee&#34;,
            &#34;_id&#34;: &#34;1&#34;,
            &#34;_score&#34;: 1,
            &#34;_source&#34;: {
               &#34;first_name&#34;: &#34;John&#34;,
               &#34;last_name&#34;: &#34;Smith&#34;,
               &#34;age&#34;: 25,
               &#34;about&#34;: &#34;I love to go rock climbing&#34;,
               &#34;interests&#34;: [
                  &#34;sports&#34;,
                  &#34;music&#34;
               ]
            }
         },
         {
            &#34;_index&#34;: &#34;megacorp&#34;,
            &#34;_type&#34;: &#34;employee&#34;,
            &#34;_id&#34;: &#34;2&#34;,
            &#34;_score&#34;: 1,
            &#34;_source&#34;: {
               &#34;first_name&#34;: &#34;Jane&#34;,
               &#34;last_name&#34;: &#34;Smith&#34;,
               &#34;age&#34;: 32,
               &#34;about&#34;: &#34;I like to collect rock albums&#34;,
               &#34;interests&#34;: [
                  &#34;music&#34;
               ]
            }
         }
      ]
   },
   &#34;aggregations&#34;: {
      &#34;all_interests&#34;: {
         &#34;buckets&#34;: [
            {
               &#34;key&#34;: &#34;music&#34;,
               &#34;doc_count&#34;: 2
            },
            {
               &#34;key&#34;: &#34;forestry&#34;,
               &#34;doc_count&#34;: 1
            },
            {
               &#34;key&#34;: &#34;sports&#34;,
               &#34;doc_count&#34;: 1
            }
         ]
      }
   }
}
</code></pre></div><p>Can be combined with Query</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback"># Calculate the most popular interests for
# employees named &#34;Smith&#34;
GET /megacorp/employee/_search
{
  &#34;query&#34;: {
    &#34;match&#34;: {
      &#34;last_name&#34;: &#34;smith&#34;
    }
  },
  &#34;aggs&#34;: {
    &#34;all_interests&#34;: {
      &#34;terms&#34;: {
        &#34;field&#34;: &#34;interests&#34;
      }
    }
  }
}

</code></pre></div><p>REsult</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">{
   &#34;took&#34;: 1,
   &#34;timed_out&#34;: false,
   &#34;_shards&#34;: {
      &#34;total&#34;: 5,
      &#34;successful&#34;: 5,
      &#34;failed&#34;: 0
   },
   &#34;hits&#34;: {
      &#34;total&#34;: 2,
      &#34;max_score&#34;: 0.30685282,
      &#34;hits&#34;: [
         {
            &#34;_index&#34;: &#34;megacorp&#34;,
            &#34;_type&#34;: &#34;employee&#34;,
            &#34;_id&#34;: &#34;1&#34;,
            &#34;_score&#34;: 0.30685282,
            &#34;_source&#34;: {
               &#34;first_name&#34;: &#34;John&#34;,
               &#34;last_name&#34;: &#34;Smith&#34;,
               &#34;age&#34;: 25,
               &#34;about&#34;: &#34;I love to go rock climbing&#34;,
               &#34;interests&#34;: [
                  &#34;sports&#34;,
                  &#34;music&#34;
               ]
            }
         },
         {
            &#34;_index&#34;: &#34;megacorp&#34;,
            &#34;_type&#34;: &#34;employee&#34;,
            &#34;_id&#34;: &#34;2&#34;,
            &#34;_score&#34;: 0.30685282,
            &#34;_source&#34;: {
               &#34;first_name&#34;: &#34;Jane&#34;,
               &#34;last_name&#34;: &#34;Smith&#34;,
               &#34;age&#34;: 32,
               &#34;about&#34;: &#34;I like to collect rock albums&#34;,
               &#34;interests&#34;: [
                  &#34;music&#34;
               ]
            }
         }
      ]
   },
   &#34;aggregations&#34;: {
      &#34;all_interests&#34;: {
         &#34;buckets&#34;: [
            {
               &#34;key&#34;: &#34;music&#34;,
               &#34;doc_count&#34;: 2
            },
            {
               &#34;key&#34;: &#34;sports&#34;,
               &#34;doc_count&#34;: 1
            }
         ]
      }
   }
}
</code></pre></div><p>Aggregation with average computation:</p>
<h2 id="hierarchical-roll-ups">Hierarchical roll-ups</h2>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">
# Calculate the average age of employee per interest
GET /megacorp/employee/_search
{
    &#34;aggs&#34; : {
        &#34;all_interests&#34; : {
            &#34;terms&#34; : { &#34;field&#34; : &#34;interests&#34; },
            &#34;aggs&#34; : {
                &#34;avg_age&#34; : {
                    &#34;avg&#34; : { &#34;field&#34; : &#34;age&#34; }
                }
            }
        }
    }
}
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">{
   &#34;took&#34;: 1,
   &#34;timed_out&#34;: false,
   &#34;_shards&#34;: {
      &#34;total&#34;: 5,
      &#34;successful&#34;: 5,
      &#34;failed&#34;: 0
   },
   &#34;hits&#34;: {
      &#34;total&#34;: 3,
      &#34;max_score&#34;: 1,
      &#34;hits&#34;: [
         {
            &#34;_index&#34;: &#34;megacorp&#34;,
            &#34;_type&#34;: &#34;employee&#34;,
            &#34;_id&#34;: &#34;3&#34;,
            &#34;_score&#34;: 1,
            &#34;_source&#34;: {
               &#34;first_name&#34;: &#34;Douglas&#34;,
               &#34;last_name&#34;: &#34;Fir&#34;,
               &#34;age&#34;: 35,
               &#34;about&#34;: &#34;I like to build cabinets&#34;,
               &#34;interests&#34;: [
                  &#34;forestry&#34;
               ]
            }
         },
         {
            &#34;_index&#34;: &#34;megacorp&#34;,
            &#34;_type&#34;: &#34;employee&#34;,
            &#34;_id&#34;: &#34;1&#34;,
            &#34;_score&#34;: 1,
            &#34;_source&#34;: {
               &#34;first_name&#34;: &#34;John&#34;,
               &#34;last_name&#34;: &#34;Smith&#34;,
               &#34;age&#34;: 25,
               &#34;about&#34;: &#34;I love to go rock climbing&#34;,
               &#34;interests&#34;: [
                  &#34;sports&#34;,
                  &#34;music&#34;
               ]
            }
         },
         {
            &#34;_index&#34;: &#34;megacorp&#34;,
            &#34;_type&#34;: &#34;employee&#34;,
            &#34;_id&#34;: &#34;2&#34;,
            &#34;_score&#34;: 1,
            &#34;_source&#34;: {
               &#34;first_name&#34;: &#34;Jane&#34;,
               &#34;last_name&#34;: &#34;Smith&#34;,
               &#34;age&#34;: 32,
               &#34;about&#34;: &#34;I like to collect rock albums&#34;,
               &#34;interests&#34;: [
                  &#34;music&#34;
               ]
            }
         }
      ]
   },
   &#34;aggregations&#34;: {
      &#34;all_interests&#34;: {
         &#34;buckets&#34;: [
            {
               &#34;key&#34;: &#34;music&#34;,
               &#34;doc_count&#34;: 2,
               &#34;avg_age&#34;: {
                  &#34;value&#34;: 28.5
               }
            },
            {
               &#34;key&#34;: &#34;forestry&#34;,
               &#34;doc_count&#34;: 1,
               &#34;avg_age&#34;: {
                  &#34;value&#34;: 35
               }
            },
            {
               &#34;key&#34;: &#34;sports&#34;,
               &#34;doc_count&#34;: 1,
               &#34;avg_age&#34;: {
                  &#34;value&#34;: 25
               }
            }
         ]
      }
   }
}

</code></pre></div><h1 id="experiments-with-loaded-logs">Experiments with loaded logs</h1>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">GET /_all/logs/_search
{
  &#34;query&#34;: {
    &#34;match_all&#34;: {}
  }
}
 
 
GET /_all/logs/_search
{
  &#34;query&#34;: {
    &#34;match&#34;: {
      &#34;level&#34;: &#34;ERROR&#34;
    }
  }
}
</code></pre></div><h2 id="retrieve-document">Retrieve document:</h2>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">GET /website/blog/123?pretty
 
# only source, no metadata
GET /website/blog/123/_source
 
# only some fields
GET /website/blog/123?_source=title,text
</code></pre></div><h2 id="existence-check">Existence check</h2>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">curl -i -XHEAD http://localhost:9200/website/blog/123
 
HTTP/1.1 200 OK
Content-Type: text/plain; charset=UTF-8
Content-Length: 0
 
curl -i -XHEAD http://localhost:9200/website/blog/124
 
HTTP/1.1 404 Not Found
Content-Type: text/plain; charset=UTF-8
Content-Length: 0
</code></pre></div><h2 id="update">Update</h2>
<p>whole doc - same index API</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">PUT /website/blog/123
{
  &#34;title&#34;: &#34;My first blog entry&#34;,
  &#34;text&#34;:  &#34;I am starting to get the hang of this...&#34;,
  &#34;date&#34;:  &#34;2014/01/02&#34;
}
 
# note new version, created false
{
  &#34;_index&#34; :   &#34;website&#34;,
  &#34;_type&#34; :    &#34;blog&#34;,
  &#34;_id&#34; :      &#34;123&#34;,
  &#34;_version&#34; : 2,
  &#34;created&#34;:   false 
}
</code></pre></div><p>Internally, Elasticsearch has marked the old document as deleted and added an entirely new document. The old version of the document doesn’t disappear immediately, although you won’t be able to access it. Elasticsearch cleans up deleted documents in the background as you continue to index more data.</p>
<h2 id="create">Create</h2>
<p>let the ES generate new ID</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">POST /website/blog/
{ ... }
 
# or force our ID but want to allow create only, not update
 
PUT /website/blog/123?op_type=create
{ ... }
 
# another way
PUT /website/blog/123/_create
{ ... }
 
# will error if it exists:
 
{
  &#34;error&#34; : &#34;DocumentAlreadyExistsException[[website][4] [blog][123]:
             document already exists]&#34;,
  &#34;status&#34; : 409
}
</code></pre></div><h2 id="delete">Delete</h2>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">GET /logstash-2014.08.21/_search
 
{
   &#34;took&#34;: 1,
   &#34;timed_out&#34;: false,
   &#34;_shards&#34;: {
      &#34;total&#34;: 5,
      &#34;successful&#34;: 5,
      &#34;failed&#34;: 0
   },
   &#34;hits&#34;: {
      &#34;total&#34;: 1,
      &#34;max_score&#34;: 1,
      &#34;hits&#34;: [
         {
            &#34;_index&#34;: &#34;logstash-2014.08.21&#34;,
            &#34;_type&#34;: &#34;logs&#34;,
            &#34;_id&#34;: &#34;cjV9RKSBS5K5pRh7QlfllQ&#34;,
            &#34;_score&#34;: 1,
            &#34;_source&#34;: {
               &#34;message&#34;: &#34;asdasdasd asasdasd&#34;,
               &#34;@version&#34;: &#34;1&#34;,
               &#34;@timestamp&#34;: &#34;2014-08-21T21:41:46.016Z&#34;,
               &#34;host&#34;: &#34;Miros-MacBook-Pro-2.local&#34;
            }
         }
      ]
   }
}
 
 
DELETE /logstash-2014.08.21/logs/cjV9RKSBS5K5pRh7QlfllQ
 
{
   &#34;found&#34;: true,
   &#34;_index&#34;: &#34;logstash-2014.08.21&#34;,
   &#34;_type&#34;: &#34;logs&#34;,
   &#34;_id&#34;: &#34;cjV9RKSBS5K5pRh7QlfllQ&#34;,
   &#34;_version&#34;: 2
}
 
GET /logstash-2014.08.21/_search
 
{
   &#34;took&#34;: 0,
   &#34;timed_out&#34;: false,
   &#34;_shards&#34;: {
      &#34;total&#34;: 5,
      &#34;successful&#34;: 5,
      &#34;failed&#34;: 0
   },
   &#34;hits&#34;: {
      &#34;total&#34;: 0,
      &#34;max_score&#34;: null,
      &#34;hits&#34;: []
   }
}
</code></pre></div><p>afterwards, index still exist:</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">
➜  elasticsearch-1.3.2  es -v indices
status name                pri rep size    bytes   docs
yellow logstash-2014.08.21   5   1         11946      0
yellow shakespeare           5   1      19087632 111396
yellow logstash-2014.08.22   5   1         47220     18
yellow megacorp              5   1         11067      3
yellow logstash-2014.08.27   5   1      24996521  14490
yellow logstash-2014.08.28   5   1      36012778  22645
yellow kibana-int            5   1         36253      3
yellow .marvel-kibana        5   1          3586      1
yellow .marvel-2014.08.28    1   1      16360673   7980
yellow logstash-2013.12.11   5   1          9943      1
</code></pre></div>
    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">Author</span>
    <span class="item-content">Miro Adamy</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">LastMod</span>
    <span class="item-content">
        2014-08-28
        
    </span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">License</span>
    <span class="item-content">(c) 2006-2020 Miro Adamy</span>
  </p>
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/search/">search</a>
          <a href="/tags/elastic/">elastic</a>
          <a href="/tags/tutorial/">tutorial</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/posts/2014-09-03-gitbits/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Few gitbits</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/posts/2014-08-27-es1/">
            <span class="next-text nav-default">Elastic search and Kibana - getting started</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:miro.adamy@gmail.com" class="iconfont icon-email" title="email"></a>
      <a href="https://www.linkedin.com/in/miroadamy/" class="iconfont icon-linkedin" title="linkedin"></a>
      <a href="https://stackoverflow.com/users/369692/miro-a" class="iconfont icon-stack-overflow" title="stack-overflow"></a>
      <a href="https://github.com/miroadamy" class="iconfont icon-github" title="github"></a>
      <a href="https://gitlab.com/miro.adamy" class="iconfont icon-gitlab" title="gitlab"></a>
      <a href="https://bitbucket.org/%7Bc05adff9-951c-4ad1-9a83-e43a1af1b81a%7D/" class="iconfont icon-link" title="link"></a>
      <a href="https://www.instagram.com/miro.adamy/?hl=sk" class="iconfont icon-instagram" title="instagram"></a>
      <a href="https://twitter.com/miroadamy" class="iconfont icon-twitter" title="twitter"></a>
      <a href="https://www.facebook.com/miro.adamy" class="iconfont icon-facebook" title="facebook"></a>
  <a href="https://miroadamy.com/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2006 - 
    2020
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">olOwOlo</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script src="/lib/highlight/highlight.pack.js?v=20171001"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>
<script type="text/javascript" src="/dist/even.26188efa.min.js"></script>








</body>
</html>
